//media upload pages

function dropzoneLoad() {
    Dropzone.options.uploadMedia = {
        maxFiles: 1,
        paramName: "file",
        maxFilesize: 20,
        uploadMultiple: false,
        acceptedFiles: ".webp, .svg",
        init: function() {
            this.on("success", function(file, response) {
                loadMedia();
            })
        }
    };
}
$('#mediaUpload').on('shown.bs.modal', function() {
    dropzoneLoad();
});

$('#mediaUpload').on('hidden.bs.modal', function() {
    $('#media-table').DataTable().ajax.reload();
});

// common component

function mediaUpload() {
    Dropzone.options.uploadImage = {
        maxFiles: 1,
        paramName: "file",
        maxFilesize: 20,
        uploadMultiple: false,
        acceptedFiles: ".webp, .svg",
        init: function() {
            this.on("success", function(file, response) {
                gallery(); 
            })
        }
    };
}
function gallery() {
    $('#media-gallery').empty();
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': jQuery('meta[name="csrf-token"]').attr('content')
        }
    });
    $.ajax({
        type: 'GET',
        url: mediaUrl,
        dataType: 'JSON',
        success: function(response) {
            response[0].forEach(function(key){
                $('#media-gallery').append("<div class='col-md-* p-1'> <button class='gallery-img p-1 btn btn-outline-info' data-image='"+key.media_name+"' data-media='"+key.media_id+"' data-bs-dismiss='modal' aria-label='Close'><img src='"+key.media_path+"' /></button></div>");
            });
        }
    });
}
$('#uploadMediaModal').on('shown.bs.modal', function() {
    mediaUpload();
    $('#media-gallery').empty();
    gallery();
});
$(document).on("click", "#media-gallery button.gallery-img", function() {
    var media = $(this).data('media');
    var image = $(this).data('image');
    $('#media_id').val(media);
    $('#image').val(image);
    $('#uploadMediaModal').modal('hide.bs.modal');
});


